#!/usr/bin/env groovy

def releaseNumber = "184"
def buildNumber = "${env.BUILD_NUMBER}"
def buildOffset = "5"
def minorVersion = "${buildNumber}".toInteger() - "${buildOffset}".toInteger()

stage('Checkout') {
  node {
    deleteDir()

    checkout scm

    currentBuild.displayName = "#${buildNumber}:${releaseNumber}.${minorVersion}"
  }
}

stage('Build') {
  node {
    sh 'make build'
  }
}

stage('Container upload') {
  node {
    sh "make upload RELEASE=1.${releaseNumber}.${minorVersion}"
  }
}
